{% extends "base.html" %}
{% load static %}

{% block title %}Каталог товаров{% endblock %}

{% block content %}
<h1 class="mb-4">Каталог товаров</h1>

<form method="get" class="mb-4">
  <div class="row">
    <div class="col-md-3">
      {{ filterset.form.name.label_tag }}
      {{ filterset.form.name }}
    </div>
    <div class="col-md-3">
      {{ filterset.form.category.label_tag }}
      {{ filterset.form.category }}
    </div>
    <div class="col-md-2">
      {{ filterset.form.price_min.label_tag }}
      {{ filterset.form.price_min }}
    </div>
    <div class="col-md-2">
      {{ filterset.form.price_max.label_tag }}
      {{ filterset.form.price_max }}
    </div>
    <div class="col-md-2 align-self-end">
      <button type="submit" class="btn btn-primary w-100">Поиск</button>
    </div>
  </div>
</form>

<div class="pagination" style="text-align: center; margin-top: 2rem; margin-bottom: 3rem;">
  {% if page_obj.has_other_pages %}
    <div style="display: inline-block;">
      {% if page_obj.has_previous %}
        <a href="?{% if request.GET %}{{ request.GET.urlencode|safe|cut:'page=' }}&{% endif %}page={{ page_obj.previous_page_number }}" class="btn" style="margin: 0 5px;">← Назад</a>
      {% endif %}

      {% for num in page_obj.paginator.page_range %}
        {% if num == page_obj.number %}
          <span class="btn" style="margin: 0 5px; background-color: #6200ee; cursor: default;">{{ num }}</span>
        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
          <a href="?{% if request.GET %}{{ request.GET.urlencode|safe|cut:'page=' }}&{% endif %}page={{ num }}" class="btn" style="margin: 0 5px;">{{ num }}</a>
        {% endif %}
      {% endfor %}

      {% if page_obj.has_next %}
        <a href="?{% if request.GET %}{{ request.GET.urlencode|safe|cut:'page=' }}&{% endif %}page={{ page_obj.next_page_number }}" class="btn" style="margin: 0 5px;">Вперёд →</a>
      {% endif %}
    </div>
  {% endif %}
</div>

<div class="row">
    {% for post in posts %}
        <div class="col-md-3 mb-4">
            <div class="card h-100 text-light" style="background-color: #1e1e1e; border: none; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);">

                <img src="{{ post.image.url }}" class="card-img-top"
                 alt="{{ post.name }}"
                 style="height: 300px; object-fit: cover; border-bottom: 1px solid #333;">


                <div class="card-body">
                    <h5 class="card-title">{{ post.name }}</h5>
                    <p class="card-text">
                        {% if post.discount > 0 %}
                            <del style="color: #888;">{{ post.price }} $</del><br>
                            <strong style="color: #bb86fc;">{{ post.get_price_with_discount|floatformat:2 }} $</strong>
                        {% else %}
                            {{ post.price }} $
                        {% endif %}
                    </p>
                    <a href="{% url 'main:product_detail' post.pk %}" class="btn btn-outline-light btn-sm">Подробнее</a>
                </div>
            </div>
        </div>
    {% empty %}
        <p class="text-muted">Нет товаров для отображения.</p>
    {% endfor %}
</div>

{% endblock %}

